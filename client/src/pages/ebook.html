<template>
  <require from="components/authors"></require>
   <require from="components/genres-converter"></require>
   <require from="components/context-menu/context-menu"></require>
   <require from="components/rating/rating"></require>
  <section>
    <h2 class="page-title">
      <span class="title">${ebook.title}</span>
      <span class="actions">
      <a route-href="route: ebook-edit; params.bind: {id:ebook.id}" if.bind="isEditable"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
    </span>
    </h2>
    <authors authors.bind="ebook.authors"></authors>
    <div class="ebook-panel">
    <div class="ebook-cover-big" id="cover-holder">
    </div>
    <div class="ebook-details">
    <ul class="list-group ebook-properties">
      <li class="list-group-item">
        <label class="ebook-detail-label">Language:</label>
        <span class="ebook-language">${ebook.language.name}</span>
      </li>
      <li class="list-group-item" if.bind="ebook.series">
        <label class="ebook-detail-label">Series:</label>
        <span class="ebook-detail-value">${ebook.series.title} #${ebook.series_index}</span>
      </li>
      <li class="list-group-item">
        <label class="ebook-detail-label">Genres:</label>
        <span class="ebook-detail-value">${ebook.genres | genres}</span>
      </li>
      <li class="list-group-item">
        <label class="ebook-detail-label">Rating:</label>
        <span class="ebook-rating"><rating size=2 rating.bind="ebook.rating"></rating></span>
      </li>
      <li class="list-group-item">
        <label class="ebook-detail-label">Created:</label>
        <span class="ebook-date">${ebook.created}</span>
      </li>
      <li class="list-group-item">
        <label class="ebook-detail-label">Find Details On:</label>
        <a if.bind="ebook.language.code=='cs'" class="ext-link" target="_blank" href="http://www.databazeknih.cz/search?q=${searchString}">DatabazeKnih</a>
        <a class="ext-link" target="_blank" href="http://www.goodreads.com/search?q=${searchString}">GoodReads</a>
      </li>
      <li class="list-group-item" if.bind="convertedSources.length">
        <label class="ebook-detail-label">Recently Converted To:</label>
        <a class="converted-sources-item" repeat.for="converted of convertedSources"
        href="${client.baseUrl}/api/download-converted/${converted.id}?bearer_token=${token}">${converted.format} </a>
      </li>

    </ul>
  </div>
  </div>
    <table class="table">
      <tr><th>Format</th><th>Size</th><th>Quality</th><th>Action</th></tr>
      <tr repeat.for="source of ebook.sources">
        <td>${source.format}</td>
        <td>${source.size}</td>
        <td><rating rating.bind="source.quality" read-only="1"></rating></td>
        <td class="ebook-actions"><a if.bind="canDownload" href="${client.baseUrl}/api/download/${source.id}?bearer_token=${token}" title="Download File">
            <i class="fa fa-download source-action"></i></a>
          <a if.bind="canConvert" href="#" click.delegate="menuConvert.show($event, source)"
            title.bind="source.error || 'Convert'"><i class="fa fa-cog source-action ${source.active? 'fa-spin':''} ${source.error?'text-danger':''}"></i></a>
          <a if.bind="true" href="#" click.delegate="deleteSource(source)" title="Delete File"><i class="fa fa-minus-circle source-action"></i></a>
        </td>
      </tr>
    </table>
    <context-menu items.bind="[{text:'epub', value:'epub'}, {text:'mobi', value:'mobi'}]" title="Convert to"
    view-model.ref="menuConvert" action.bind="convertSource"></context-menu>
  </section>

</template>
