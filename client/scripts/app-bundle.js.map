{"version":3,"sources":["app.js","environment.js","main.js","pub-app.js","routes.js","components/author.js","components/authors-converter.js","components/authors-edit.js","components/authors.js","components/blur-image.js","components/confirm-dialog.js","components/ebook-action-list.js","components/ebook-panel.js","components/error-alert.js","components/genres-converter.js","components/genres-edit.js","components/list-converter.js","components/nav-bar.js","components/notification-base.js","components/notification-convert.js","components/notification-metadata.js","components/notifications-drawer.js","components/search.js","config/auth-config.js","config/config.js","lib/access.js","lib/api-client.js","lib/application-state.js","lib/notification.js","lib/ws-client.js","models/ebook.js","pages/author.js","pages/ebook-edit.js","pages/ebook.js","pages/ebooks.js","pages/login.js","pages/search.js","pages/upload-result.js","pages/upload.js","pages/welcome.js","test/test-page.js","components/autocomplete/autocomplete.js","components/context-menu/context-menu.js","components/pagination/index.js","components/pagination/page-controller.js","components/pagination/pager.js","components/pagination/sorter.js","components/rating/rating.js","lib/config/config.js","lib/config/index.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/auth-service.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/authentication.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/base-config.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/auth-utilities.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/storage.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/oAuth1.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/popup.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/oAuth2.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/authorize-step.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/auth-fetch-config.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-auth/dist/amd/auth-filter.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/ai-dialog.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/ai-dialog-header.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/dialog-controller.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/lifecycle.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/dialog-result.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/ai-dialog-body.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/ai-dialog-footer.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/attach-focus.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/dialog-configuration.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/renderer.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/dialog-renderer.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/dialog-options.js","/home/ivan/tmp/mybookshelf2/client/node_modules/aurelia-dialog/dist/amd/dialog-service.js","/home/ivan/tmp/mybookshelf2/client/src/app.html","/home/ivan/tmp/mybookshelf2/client/src/components/autocomplete/autocomplete.css","/home/ivan/tmp/mybookshelf2/client/src/pub-app.html","/home/ivan/tmp/mybookshelf2/client/src/components/context-menu/context-menu.css","/home/ivan/tmp/mybookshelf2/client/src/components/author.html","/home/ivan/tmp/mybookshelf2/client/src/components/authors-edit.html","/home/ivan/tmp/mybookshelf2/client/src/components/rating/rating.css","/home/ivan/tmp/mybookshelf2/client/src/components/authors.html","/home/ivan/tmp/mybookshelf2/client/src/components/confirm-dialog.html","/home/ivan/tmp/mybookshelf2/client/src/components/ebook-action-list.html","/home/ivan/tmp/mybookshelf2/client/src/components/ebook-panel.html","/home/ivan/tmp/mybookshelf2/client/src/components/error-alert.html","/home/ivan/tmp/mybookshelf2/client/src/components/genres-edit.html","/home/ivan/tmp/mybookshelf2/client/src/components/nav-bar.html","/home/ivan/tmp/mybookshelf2/client/src/components/notification-convert.html","/home/ivan/tmp/mybookshelf2/client/src/components/notification-metadata.html","/home/ivan/tmp/mybookshelf2/client/src/components/notifications-drawer.html","/home/ivan/tmp/mybookshelf2/client/src/components/search.html","/home/ivan/tmp/mybookshelf2/client/src/pages/author.html","/home/ivan/tmp/mybookshelf2/client/src/pages/ebook-edit.html","/home/ivan/tmp/mybookshelf2/client/src/pages/ebook.html","/home/ivan/tmp/mybookshelf2/client/src/pages/ebooks.html","/home/ivan/tmp/mybookshelf2/client/src/pages/login.html","/home/ivan/tmp/mybookshelf2/client/src/pages/search.html","/home/ivan/tmp/mybookshelf2/client/src/pages/upload-result.html","/home/ivan/tmp/mybookshelf2/client/src/pages/upload.html","/home/ivan/tmp/mybookshelf2/client/src/pages/welcome.html","/home/ivan/tmp/mybookshelf2/client/src/test/test-page.html","/home/ivan/tmp/mybookshelf2/client/src/components/autocomplete/autocomplete-authors.html","/home/ivan/tmp/mybookshelf2/client/src/components/autocomplete/autocomplete-ebooks.html","/home/ivan/tmp/mybookshelf2/client/src/components/autocomplete/autocomplete-series.html","/home/ivan/tmp/mybookshelf2/client/src/components/autocomplete/autocomplete.html","/home/ivan/tmp/mybookshelf2/client/src/components/context-menu/context-menu.html","/home/ivan/tmp/mybookshelf2/client/src/components/pagination/pager.html","/home/ivan/tmp/mybookshelf2/client/src/components/pagination/sorter.html","/home/ivan/tmp/mybookshelf2/client/src/components/rating/rating.html"],"names":["logger","getLogger","App","config","fetchConfig","client","wsClient","access","configure","conf","withBaseUrl","get","window","location","hostname","withInterceptor","response","status","warn","router","navigateToRoute","Error","configureRouter","title","addPipelineStep","map","activate","signalState","isAuthenticated","authenticated","doSearch","query","encodeURIComponent","debug","testing","Promise","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","plugin","baseConfig","useDefaults","settings","lock","centerHorizontalOnly","startingZIndex","developmentLogging","start","then","setRoot","route","name","moduleId","ROUTES","nav","auth","Author","author","id","first_name","last_name","AuthorsValueConverter","toView","val","a","firstname","lastname","join","AuthorsEdit","getFullName","item","addAuthor","addIfNotExists","authors","push","_author","_authorSelected","splitFullName","removeAuthor","selected","undefined","splice","parts","split","x","trim","splittedName","length","slice","getIndex","Authors","compact","BlurImageCustomAttribute","Element","element","valueChanged","newImage","complete","drawBlur","onload","mul_table","shg_table","BLUR_RADIUS","stackBlurCanvasRGBA","canvas","top_x","top_y","width","height","radius","isNaN","context","getContext","imageData","getImageData","e","pixels","data","y","i","p","yp","yi","yw","r_sum","g_sum","b_sum","a_sum","r_out_sum","g_out_sum","b_out_sum","a_out_sum","r_in_sum","g_in_sum","b_in_sum","a_in_sum","pr","pg","pb","pa","rbs","div","w4","widthMinus1","heightMinus1","radiusPlus1","sumFactor","stackStart","BlurStack","stack","next","stackEnd","stackIn","stackOut","mul_sum","shg_sum","r","g","b","putImageData","image","w","h","canvasContext","drawImage","ConfirmDialog","controller","model","action","message","EbookActionList","ebooks","lastPage","EbookPanel","http","loaderChanged","handleImgError","evt","target","parent","addClass","handleImgLoad","removeClass","getThumbSource","ebook","baseUrl","key","ErrorAlert","defaultBindingMode","twoWay","clearError","error","GenresValueConverter","GenresEdit","hasId","genres","genre","addGenre","_selected","removeGenre","allGenres","filter","ListValueConverter","list","prop","NavBar","searchSubmitted","collapse","NotificationBase","notification","navigate","result","done","NotificationMetadata","ebookId","NotificationsDrawer","elem","notif","attention","attentionTimeout","_dispose","addObserver","onNotificationsUpdated","bind","attached","root","icon","_to","setTimeout","clearTimeout","drawerMove","hasClass","Search","executeSearch","execute","configForDevelopment","loginUrl","providers","google","clientId","linkedin","facebook","configForProduction","Access","authUtil","event","util","hasRole","token","getTokenPayload","roles","requiredRoles","checkRoles","reduce","prev","curr","includes","canEdit","userId","login","username","password","err","JSON","stringify","publish","user","currentUser","logout","authenticate","getToken","email","ApiClient","apiPath","_cache","Map","getUrl","param","post","resource","fetch","method","body","resp","json","delete","patch","url","getManyUnpagedCached","now","Date","has","ts","resolve","set","getManyUnpaged","getMany","page","pageSize","sort","extra","page_size","k","hasOwnProperty","Math","ceil","total","items","search","authorBooks","getOne","checkUpload","fileInfo","upload","formData","addUploadToEbook","uploadId","quality","upload_id","getCover","blob","ApplicationState","userName","MAX_SIZE","Notification","_observers","Set","_ns","_details","o","add","updateObservers","forEach","taskId","taskInfo","unshift","pop","update","obj","Object","assign","task","markDone","WSClient","conn","session","AUTOBAHN_DEBUG","subscribe","connect","disconnect","userEmail","connUrl","Connection","realm","authmethods","authid","onchallenge","onChallenge","onopen","details","onConnectionOpen","onclose","onConnectionClose","open","close","receiveNotification","args","kwargs","options","reason","extractMeta","fileName","originalFileName","proposedMeta","isConnected","alert","call","text","file","convertSource","source","format","sourceId","Ebook","_editableProps","bindingEngine","instance","_disposers","_changed","asArray","observer","propName","disp","propertyObserver","n","changed","newObj","shift","collectionObserver","editableProps2","isNew","dispose","d","validate","addError","language","series","series_index","Number","isInteger","match","prepareData","shrink","keys","shrinkList","l","compareObjects","o1","o2","editableProps","Array","isArray","version_id","endsWith","params","decodeURIComponent","updateLoader","filterChanged","_loader","EditEbook","dialog","canActivate","_series","created_by","catch","promises","_languages","_genres","meta","all","prefill","deactivate","_seriesChanged","_seriesSelected","save","res","errorDetail","error_details","res2","remove","errors","what","grp","appendTo","cancel","canDelete","viewModel","wasCancelled","ws","canDownload","canConvert","cover","Image","URL","revokeObjectURL","src","subscribeConvertEvents","deactivateSource","sources","s","active","msg","updateConverted","createObjectURL","convertedSources","document","getElementById","appendChild","canDeleteSource","deleteSource","idx","findIndex","Ebooks","history","state","Login","canDeactivate","ctx","newCtx","UploadResult","metaId","load_source","ebooksCandidates","createNew","ebooksSearched","hex","buffer","hexCodes","view","DataView","byteLength","value","getUint32","stringValue","toString","padding","paddedValue","Upload","fileOK","uploading","checking","uploadError","FormData","origName","rating","checkFile","files","size","mime_type","type","hash","reader","FileReader","crypto","subtle","digest","readAsArrayBuffer","Welcome","TestPage","seriesSelected","CACHE_DURATION","startsWith","string","clean","toLowerCase","Autocomplete","_suggestions","_suggestionsShown","_ignoreChange","_attached","selectedValue","minLength","hideSuggestions","getSuggestions","suggestions","showSuggestions","suggestionsList","getSuggestionValue","valueKey","forValue","loader","reject","keyPressed","keyCode","select","makeVisible","position","scrollTop","top","newValue","hide","show","ContextMenu","click","stopPropagation","pageX","pageY","offset","left","win","bottom","right","globalResources","PageController","loading","created","owningView","myView","noSort","loadPage","unbinded","pageChanged","newPage","replaceState","sortChanged","old","reset","oldPage","Pager","activated","nextPage","prevPage","min","max","sorter","Rating","stars","numStars","rated","proposed","updateRating","v","round","ratingChanged","onRatingChange","propose","readOnly","clearProposed","rate","resetRating","Configure","_config","defval","cb","container"],"mappings":"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oW,WAAU/V,QAAQmkB,SAAR,CAAkB9lB,GAAlB,mBAAd;AACA,QAAI6lB,MAAM,OAAOA,EAAP,IAAW,UAArB,EAAiC;AAC/BA,SAAGnO,QAAH;AACD;AACF;;UAEOgO;;ACbR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACfA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpHA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA;ACAA","file":"app-bundle.js","sourcesContent":["import { FetchConfig, AuthorizeStep} from 'aurelia-auth';\nimport {inject,LogManager,bindable} from 'aurelia-framework';\nimport { HttpClient} from 'aurelia-fetch-client';\nimport {Configure} from 'lib/config/index';\nimport {WSClient} from 'lib/ws-client';\nimport {Access} from 'lib/access';\nimport {ROUTES} from 'routes';\n\nconst logger = LogManager.getLogger('app');\n@inject(Configure, FetchConfig, HttpClient, WSClient, Access)\nexport class App {\n  constructor(config, fetchConfig, client, wsClient, access) {\n    this.config = config;\n    this.access=access;\n    fetchConfig.configure();\n    client.configure(conf => conf\n      .withBaseUrl(`http://${this.config.get('api.host',window.location.hostname)}:${this.config.get('api.port', 80)}`)\n\n      .withInterceptor({\n        response: response => {\n          if (response && response.status == 401) {\n            logger.warn('Not authenticated!');\n            this.router.navigateToRoute('login');\n            throw new Error('Not autherticated!');\n\n          } else if (response && response.status >= 300)\n            throw new Error(`HTTP error ${response.status}`);\n          return response;\n        }\n      })\n    );\n\n  }\n\n  configureRouter(config, router) {\n    config.title = 'MyBookshelf2';\n    config.addPipelineStep('authorize', AuthorizeStep);\n    config.map(ROUTES);\n\n    this.router = router;\n  }\n\n  activate() {\n    this.access.signalState();\n  }\n\n  isAuthenticated() {\n    return this.access.authenticated;\n  }\n\n  doSearch(query) {\n    this.router.navigateToRoute('search', {\n      query: encodeURIComponent(query)\n    });\n  }\n}\n","export default {\n  debug: true,\n  testing: true\n};\n","import environment from './environment';\n\n//Configure Bluebird Promises.\n//Note: You may want to use environment-specific configuration.\nPromise.config({\n  warnings: {\n    wForgottenReturn: false\n  }\n});\nimport  'bootstrap';\nimport 'bootstrap-drawer';\nimport authConfig from 'config/auth-config';\n\nexport function configure(aurelia) {\n  aurelia.use\n    .standardConfiguration()\n    //.feature('resources')\n    .feature('components/pagination')\n    .plugin('aurelia-auth', baseConfig => baseConfig.configure(authConfig))\n    .feature('lib/config')\n    .plugin('aurelia-dialog', config => {\n      config.useDefaults();\n      config.settings.lock = false;\n      config.settings.centerHorizontalOnly = false;\n      config.settings.startingZIndex = 1045;\n    });\n\n\n  if (environment.debug) {\n    aurelia.use.developmentLogging();\n  }\n\n  if (environment.testing) {\n    aurelia.use.plugin('aurelia-testing');\n  }\n\n  //Uncomment the line below to enable animation.\n  //aurelia.use.plugin('aurelia-animator-css');\n  //if the css animator is enabled, add swap-order=\"after\" to all router-view elements\n\n  //Anyone wanting to use HTMLImports to load views, will need to install the following plugin.\n  //aurelia.use.plugin('aurelia-html-import-template-loader')\n\n  aurelia.start().then(() => aurelia.setRoot('app'));\n}\n","export class App {\n  configureRouter(config, router) {\n    config.title = 'Login to MyBookshelf2';\n    config.map([\n      {route: ['login', ''], name: 'login', moduleId:'pages/login', title:'Login'},\n    ]);\n\n    this.router = router;\n  }\n}\n","export const ROUTES =\n[{\n    route: ['', 'welcome'],\n    name: 'welcome',\n    moduleId: 'pages/welcome',\n    title: 'Welcome'\n  }, {\n    route: 'ebooks',\n    name: 'ebooks',\n    moduleId: 'pages/ebooks',\n    nav: true,\n    title: 'Ebooks',\n    auth: true\n  }, {\n    route: 'login',\n    name: 'login',\n    moduleId: 'pages/login',\n    title: 'Login'\n  }, {\n    route: 'ebook/:id',\n    name: 'ebook',\n    moduleId: 'pages/ebook',\n    title: 'Ebook',\n    auth: true\n  }, {\n    route: 'search/:query',\n    name: 'search',\n    moduleId: 'pages/search',\n    title: 'Search Results',\n    auth: true\n  }, {\n    route: ['author/:id'],\n    name: 'author',\n    moduleId: 'pages/author',\n    title: 'Authors books',\n    auth: true\n  }, {\n    route: 'upload',\n    name: 'upload',\n    moduleId: 'pages/upload',\n    title: 'Upload Ebook',\n    nav: true,\n    auth: true\n  },\n  {\n    route: 'upload-result/:id',\n    name : 'upload-result',\n    moduleId: 'pages/upload-result',\n    title: 'Upload results',\n    auth: true\n  },\n\n  {\n    route: 'ebook-edit/:id',\n    name: 'ebook-edit',\n    moduleId: 'pages/ebook-edit',\n    title: 'Edit Ebook',\n    auth: true\n  },\n  {\n    route: 'ebook-create',\n    name: 'ebook-create',\n    moduleId: 'pages/ebook-edit',\n    title: 'Create Ebook',\n    auth: true\n  },\n\n// testing routes\n  {\n    route: 'test',\n    name : 'test',\n    moduleId: 'test/test-page',\n    title: 'Just testing'\n  },\n\n\n];\n","import {bindable, computedFrom, customElement} from 'aurelia-framework'\n\n@customElement('author')\nexport class Author {\n  @bindable author;\n  @bindable last=true;\n  @bindable linked = true;\n\n  @computedFrom('author')\n  get link(){\n\n    return '#/author/'+this.author.id;\n  }\n\n  @computedFrom('author')\n  get fullName() {\n    return this.author.first_name?`${this.author.first_name} ${this.author.last_name}`:this.author.last_name;\n  }\n}\n","export class AuthorsValueConverter {\n  toView(val) {\n    if (!val) return '';\n    return val.map(a => a.firstname ? `${a.firstname} ${a.lastname}`: a.lastname).join(', ');\n  }\n}\n","import {LogManager, inject, computedFrom, bindable, bindingMode} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nimport $ from 'jquery';\n\nlet logger = LogManager.getLogger('authors-edit');\n\n@inject(ApiClient)\nexport class AuthorsEdit {\n  @bindable authors;\n  _author;\n  _authorSelected;\n\n  constructor(client) {\n    this.client=client;\n  }\n\n  get loaderAuthors() {\n    return start => this.client.getIndex('authors', start);\n  }\n\n  getFullName(item) {\n    let name= item.first_name ? item.last_name + ', ' + item.first_name : item.last_name\n    //if (!item.id) name+= ' (new)';\n    return name\n  }\n\n  //@computedFrom('authors')\n  get authorsVisible() {\n    if (this.authors && this.authors.length) {\n      return this.authors.map(this.getFullName)\n    }\n  }\n\n  addAuthor() {\n    let addIfNotExists = (author) => {\n      for (var item of this.authors) {\n        if (item.last_name === author.last_name && item.first_name === author.first_name) return;\n      }\n      this.authors.push(author);\n      this._author = '';\n    };\n\n    if (! this.authors) this.authors = [];\n    if (this._authorSelected) {\n      addIfNotExists(this._authorSelected);\n    } else if (this._author) {\n      addIfNotExists(this.splitFullName(this._author));\n    }\n  }\n\n  removeAuthor(selected) {\n    if (selected !== undefined) this.authors.splice(selected,1);\n\n  }\n\n  splitFullName(name) {\n    let parts = name.split(',').map(x => x.trim());\n    let splittedName = {last_name: parts[0]}\n    if (parts.length > 1) splittedName.first_name = parts.slice(1).join(' ');\n    return splittedName;\n  }\n}\n","\nimport {bindable, computedFrom} from 'aurelia-framework';\nexport class Authors {\n  @bindable authors=[];\n  @bindable compact=false;\n  @bindable linked = true;\n\n  @computedFrom('authors', 'compact')\n  get many() {\n    if (!this.authors) return false;\n    return this.authors.length > 2 && this.compact;\n  }\n}\n","import {inject} from 'aurelia-framework';\n\n@inject(Element)\nexport class BlurImageCustomAttribute {\n  constructor(element) {\n    this.element = element;\n  }\n\n  valueChanged(newImage) {\n    if (newImage.complete) {\n      drawBlur(this.element, newImage);\n    } else {\n      newImage.onload = () => drawBlur(this.element, newImage);\n    }\n  }\n}\n\n/* eslint-disable */\n\n/*\nThis Snippet is using a modified Stack Blur js lib for blurring the header images.\n*/\n\n/*\n\nStackBlur - a fast almost Gaussian Blur For Canvas\n\nVersion:     0.5\nAuthor:\t\tMario Klingemann\nContact: \tmario@quasimondo.com\nWebsite:\thttp://www.quasimondo.com/StackBlurForCanvas\nTwitter:\t@quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2010 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\nvar mul_table = [\n        512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,\n        454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,\n        482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,\n        437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,\n        497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,\n        320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,\n        446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,\n        329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,\n        505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,\n        399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,\n        324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,\n        268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,\n        451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,\n        385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,\n        332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,\n        289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];\n\n\nvar shg_table = [\n\t     9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17,\n\t\t17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19,\n\t\t19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,\n\t\t20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,\n\t\t21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\n\t\t22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n\t\t23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n\t\t24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24 ];\n\nvar BLUR_RADIUS = 40;\n\nfunction stackBlurCanvasRGBA( canvas, top_x, top_y, width, height, radius )\n{\n\tif ( isNaN(radius) || radius < 1 ) return;\n\tradius |= 0;\n\n\tvar context = canvas.getContext(\"2d\");\n\tvar imageData;\n\n\ttry {\n\t  imageData = context.getImageData( top_x, top_y, width, height );\n\t} catch(e) {\n\t  throw new Error(\"unable to access image data: \" + e);\n\t}\n\n\tvar pixels = imageData.data;\n\n\tvar x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum, a_sum,\n\tr_out_sum, g_out_sum, b_out_sum, a_out_sum,\n\tr_in_sum, g_in_sum, b_in_sum, a_in_sum,\n\tpr, pg, pb, pa, rbs;\n\n\tvar div = radius + radius + 1;\n\tvar w4 = width << 2;\n\tvar widthMinus1  = width - 1;\n\tvar heightMinus1 = height - 1;\n\tvar radiusPlus1  = radius + 1;\n\tvar sumFactor = radiusPlus1 * ( radiusPlus1 + 1 ) / 2;\n\n\tvar stackStart = new BlurStack();\n\tvar stack = stackStart;\n\tfor ( i = 1; i < div; i++ )\n\t{\n\t\tstack = stack.next = new BlurStack();\n\t\tif ( i == radiusPlus1 ) var stackEnd = stack;\n\t}\n\tstack.next = stackStart;\n\tvar stackIn = null;\n\tvar stackOut = null;\n\n\tyw = yi = 0;\n\n\tvar mul_sum = mul_table[radius];\n\tvar shg_sum = shg_table[radius];\n\n\tfor ( y = 0; y < height; y++ )\n\t{\n\t\tr_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;\n\n\t\tr_out_sum = radiusPlus1 * ( pr = pixels[yi] );\n\t\tg_out_sum = radiusPlus1 * ( pg = pixels[yi+1] );\n\t\tb_out_sum = radiusPlus1 * ( pb = pixels[yi+2] );\n\t\ta_out_sum = radiusPlus1 * ( pa = pixels[yi+3] );\n\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\t\ta_sum += sumFactor * pa;\n\n\t\tstack = stackStart;\n\n\t\tfor( i = 0; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack.a = pa;\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\tfor( i = 1; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tp = yi + (( widthMinus1 < i ? widthMinus1 : i ) << 2 );\n\t\t\tr_sum += ( stack.r = ( pr = pixels[p])) * ( rbs = radiusPlus1 - i );\n\t\t\tg_sum += ( stack.g = ( pg = pixels[p+1])) * rbs;\n\t\t\tb_sum += ( stack.b = ( pb = pixels[p+2])) * rbs;\n\t\t\ta_sum += ( stack.a = ( pa = pixels[p+3])) * rbs;\n\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\t\t\ta_in_sum += pa;\n\n\t\t\tstack = stack.next;\n\t\t}\n\n\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor ( x = 0; x < width; x++ )\n\t\t{\n\t\t\tpixels[yi+3] = pa = (a_sum * mul_sum) >> shg_sum;\n\t\t\tif ( pa != 0 )\n\t\t\t{\n\t\t\t\tpa = 255 / pa;\n\t\t\t\tpixels[yi]   = ((r_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t\tpixels[yi+1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t\tpixels[yi+2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n\t\t\t} else {\n\t\t\t\tpixels[yi] = pixels[yi+1] = pixels[yi+2] = 0;\n\t\t\t}\n\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\t\t\ta_sum -= a_out_sum;\n\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\t\t\ta_out_sum -= stackIn.a;\n\n\t\t\tp =  ( yw + ( ( p = x + radius + 1 ) < widthMinus1 ? p : widthMinus1 ) ) << 2;\n\n\t\t\tr_in_sum += ( stackIn.r = pixels[p]);\n\t\t\tg_in_sum += ( stackIn.g = pixels[p+1]);\n\t\t\tb_in_sum += ( stackIn.b = pixels[p+2]);\n\t\t\ta_in_sum += ( stackIn.a = pixels[p+3]);\n\n\t\t\tr_sum += r_in_sum;\n\t\t\tg_sum += g_in_sum;\n\t\t\tb_sum += b_in_sum;\n\t\t\ta_sum += a_in_sum;\n\n\t\t\tstackIn = stackIn.next;\n\n\t\t\tr_out_sum += ( pr = stackOut.r );\n\t\t\tg_out_sum += ( pg = stackOut.g );\n\t\t\tb_out_sum += ( pb = stackOut.b );\n\t\t\ta_out_sum += ( pa = stackOut.a );\n\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\t\t\ta_in_sum -= pa;\n\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += 4;\n\t\t}\n\t\tyw += width;\n\t}\n\n\n\tfor ( x = 0; x < width; x++ )\n\t{\n\t\tg_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;\n\n\t\tyi = x << 2;\n\t\tr_out_sum = radiusPlus1 * ( pr = pixels[yi]);\n\t\tg_out_sum = radiusPlus1 * ( pg = pixels[yi+1]);\n\t\tb_out_sum = radiusPlus1 * ( pb = pixels[yi+2]);\n\t\ta_out_sum = radiusPlus1 * ( pa = pixels[yi+3]);\n\n\t\tr_sum += sumFactor * pr;\n\t\tg_sum += sumFactor * pg;\n\t\tb_sum += sumFactor * pb;\n\t\ta_sum += sumFactor * pa;\n\n\t\tstack = stackStart;\n\n\t\tfor( i = 0; i < radiusPlus1; i++ )\n\t\t{\n\t\t\tstack.r = pr;\n\t\t\tstack.g = pg;\n\t\t\tstack.b = pb;\n\t\t\tstack.a = pa;\n\t\t\tstack = stack.next;\n\t\t}\n\n\t\typ = width;\n\n\t\tfor( i = 1; i <= radius; i++ )\n\t\t{\n\t\t\tyi = ( yp + x ) << 2;\n\n\t\t\tr_sum += ( stack.r = ( pr = pixels[yi])) * ( rbs = radiusPlus1 - i );\n\t\t\tg_sum += ( stack.g = ( pg = pixels[yi+1])) * rbs;\n\t\t\tb_sum += ( stack.b = ( pb = pixels[yi+2])) * rbs;\n\t\t\ta_sum += ( stack.a = ( pa = pixels[yi+3])) * rbs;\n\n\t\t\tr_in_sum += pr;\n\t\t\tg_in_sum += pg;\n\t\t\tb_in_sum += pb;\n\t\t\ta_in_sum += pa;\n\n\t\t\tstack = stack.next;\n\n\t\t\tif( i < heightMinus1 )\n\t\t\t{\n\t\t\t\typ += width;\n\t\t\t}\n\t\t}\n\n\t\tyi = x;\n\t\tstackIn = stackStart;\n\t\tstackOut = stackEnd;\n\t\tfor ( y = 0; y < height; y++ )\n\t\t{\n\t\t\tp = yi << 2;\n\t\t\tpixels[p+3] = pa = (a_sum * mul_sum) >> shg_sum;\n\t\t\tif ( pa > 0 )\n\t\t\t{\n\t\t\t\tpa = 255 / pa;\n\t\t\t\tpixels[p]   = ((r_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t\tpixels[p+1] = ((g_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t\tpixels[p+2] = ((b_sum * mul_sum) >> shg_sum ) * pa;\n\t\t\t} else {\n\t\t\t\tpixels[p] = pixels[p+1] = pixels[p+2] = 0;\n\t\t\t}\n\n\t\t\tr_sum -= r_out_sum;\n\t\t\tg_sum -= g_out_sum;\n\t\t\tb_sum -= b_out_sum;\n\t\t\ta_sum -= a_out_sum;\n\n\t\t\tr_out_sum -= stackIn.r;\n\t\t\tg_out_sum -= stackIn.g;\n\t\t\tb_out_sum -= stackIn.b;\n\t\t\ta_out_sum -= stackIn.a;\n\n\t\t\tp = ( x + (( ( p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1 ) * width )) << 2;\n\n\t\t\tr_sum += ( r_in_sum += ( stackIn.r = pixels[p]));\n\t\t\tg_sum += ( g_in_sum += ( stackIn.g = pixels[p+1]));\n\t\t\tb_sum += ( b_in_sum += ( stackIn.b = pixels[p+2]));\n\t\t\ta_sum += ( a_in_sum += ( stackIn.a = pixels[p+3]));\n\n\t\t\tstackIn = stackIn.next;\n\n\t\t\tr_out_sum += ( pr = stackOut.r );\n\t\t\tg_out_sum += ( pg = stackOut.g );\n\t\t\tb_out_sum += ( pb = stackOut.b );\n\t\t\ta_out_sum += ( pa = stackOut.a );\n\n\t\t\tr_in_sum -= pr;\n\t\t\tg_in_sum -= pg;\n\t\t\tb_in_sum -= pb;\n\t\t\ta_in_sum -= pa;\n\n\t\t\tstackOut = stackOut.next;\n\n\t\t\tyi += width;\n\t\t}\n\t}\n\n\tcontext.putImageData( imageData, top_x, top_y );\n\n}\n\nfunction BlurStack()\n{\n\tthis.r = 0;\n\tthis.g = 0;\n\tthis.b = 0;\n\tthis.a = 0;\n\tthis.next = null;\n}\n\nfunction drawBlur(canvas, image) {\n  var w = canvas.width;\n  var h = canvas.height;\n  var canvasContext = canvas.getContext('2d');\n  canvasContext.drawImage(image, 0, 0, w, h);\n  stackBlurCanvasRGBA(canvas, 0, 0, w, h, BLUR_RADIUS);\n};\n","import {inject} from \"aurelia-framework\";\nimport {DialogController} from \"aurelia-dialog\";\n\n\n@inject(DialogController)\nexport class ConfirmDialog {\n  constructor(controller) {\n    this.controller=controller;\n  }\n\n  activate(model) {\n    this.action = model.action;\n    this.message = model.message;\n  }\n}\n","import {bindable} from 'aurelia-framework';\n\nexport class EbookActionList {\n  @bindable actionName = \"Action\"\n  @bindable action\n  @bindable ebooks\n\n  get isMore() {\n    return this.ebooks && this.ebooks.lastPage > 1;\n  }\n\n\n}\n","\nimport {inject, bindable, LogManager} from 'aurelia-framework';\nimport {HttpClient} from 'aurelia-fetch-client';\nimport $ from 'jquery';\n\nconst logger=LogManager.getLogger('ebooks-panel');\n\n@inject(HttpClient)\nexport class EbookPanel {\n  @bindable sortings=[{name:'Title A-Z', key:'title'}, {name:'Title Z-A',key:'-title'},\n      {name:'Recent First', key:'-created'}, {name:'Oldest First', key: 'created'}];\n  @bindable loader;\n\n  constructor(http) {\n    this.http=http;\n  }\n\n  loaderChanged() {\n    logger.debug('Loader changed in EbookPanel');\n  }\n\n  handleImgError(evt) {\n      logger.debug('Missing thumb');\n      $(evt.target).parent().parent().addClass('missing');\n\n  }\n\n  handleImgLoad(evt) {\n      logger.debug('Load thumb');\n      $(evt.target).parent().parent().removeClass('missing');\n\n  }\n\n  getThumbSource(ebook) {\n    return this.http.baseUrl +'/thumb/'+ebook.id;\n  }\n}\n","import {LogManager, inject, computedFrom, bindable, bindingMode} from 'aurelia-framework';\n\nexport class ErrorAlert {\n  @bindable({\n    defaultBindingMode: bindingMode.twoWay\n  }) error;\n\n  clearError() {\n    this.error=undefined;\n  }\n}\n","export class GenresValueConverter {\n  toView(val) {\n    if (!val) return '';\n    return val.map(g => g.name).join(', ');\n  }\n}\n","import {LogManager, inject, computedFrom, bindable, bindingMode} from 'aurelia-framework';\n\nexport class GenresEdit {\n  @bindable allGenres;\n  @bindable genres;\n  _selected;\n\n  hasId(id) {\n    if (!this.genres) return false;\n    for (var genre of this.genres) {\n      if (id === genre.id) return true\n    }\n    return false;\n  }\n\n  get visibleGenres() {\n    return this.allGenres.filter(item => ! this.hasId(item.id));\n  }\n\n  addGenre() {\n    if (! this.genres) this.genres = [];\n    if (this._selected) this.genres.push(this._selected);\n    this._selected = undefined;\n  }\n\n  removeGenre(selected) {\n    if (selected !== undefined) this.genres.splice(selected,1);\n  }\n}\n","export class ListValueConverter {\n  toView(list, prop) {\n    if (!list || !list.length) return '';\n    if (prop) list = list.map(i => i[prop]);\n    return list.join(', ');\n  }\n}\n","import {bindable, inject, LogManager} from 'aurelia-framework'\nimport {Access} from 'lib/access';\nimport $ from 'jquery';\n\nconst logger=LogManager.getLogger('nav-bar');\n\n@inject(Access)\nexport class NavBar {\n  @bindable router;\n  @bindable doSearch;\n\n  constructor(access) {\n    this.access=access;\n  }\n\n  get isAuthenticated() {\n    return this.access.authenticated;\n  }\n\n  searchSubmitted(query) {\n    logger.debug('navbar.compo'+ $('#skeleton-navigation-navbar-collapse'));\n    $('#skeleton-navigation-navbar-collapse').collapse('hide');\n    this.doSearch(query);\n\n  }\n\n\n}\n","\nimport {bindable, inject} from 'aurelia-framework'\nimport {Router} from 'aurelia-router';\n\n@inject(Router)\nexport class NotificationBase {\n\n    constructor(router) {\n      this.router=router\n    }\n\n    get isReady() {\n      return this.notification.status === 'success' && this.notification.result && ! this.notification.done;\n    }\n\n    activate(model) {\n      this.notification = model;\n    }\n\n    navigate() {\n      throw new Error('Not Implemented');\n    }\n}\n","\nimport {NotificationBase} from './notification-base';\n\nexport class NotificationMetadata extends NotificationBase{\n    navigate() {\n      this.router.navigateToRoute('ebook', {id:this.notification.ebookId})\n    }\n}\n","\nimport {NotificationBase} from './notification-base';\n\nexport class NotificationMetadata extends NotificationBase {\n\n    navigate() {\n      this.notification.done = true;\n      this.router.navigateToRoute('upload-result', {id:this.notification.result})\n    }\n}\n","import {Notification} from 'lib/notification';\nimport {inject, LogManager} from 'aurelia-framework';\nimport {Configure} from  'lib/config/index';\nimport $ from 'jquery';\n\nlet logger = LogManager.getLogger('notifications-drawer');\n\n@inject(Element, Notification, Configure)\nexport class NotificationsDrawer {\n\n  constructor(elem,notif, config) {\n      this.notif=notif;\n      this.elem = elem;\n      this.attention;\n      this.attentionTimeout = (config.get('notificationAttentionTimeout') || 20) * 1000;\n      this._dispose = notif.addObserver(this.onNotificationsUpdated.bind(this));\n\n  }\n\n  attached() {\n    this.root = $('#drawer-notifications', this.elem);\n    this.icon = $('#drawer-icon', this.elem);\n  }\n\n  onNotificationsUpdated(action, status) {\n    logger.debug(`Got update ${action} ${status}`);\n    if (action === 'update' && (status === 'success' || status === 'error'))\n      this.attention = true;\n      this._to = window.setTimeout(() => {\n        window.clearTimeout(this._to);\n        this.attention = false;\n      },\n        this.attentionTimeout);\n  }\n\n  get fold() {\n    return this.root.hasClass('fold')\n\n  }\n\n  drawerMove() {\n    this.attention = false;\n    return true;\n  }\n\n\n}\n","import {bindable} from 'aurelia-framework';\n\nexport class Search {\n  @bindable query;\n  @bindable execute;\n\n  executeSearch() {\n\n    if (this.query) this.execute({query:this.query});\n  }\n}\n","var configForDevelopment = {\n    loginUrl: '/login',\n    providers: {\n        google: {\n            clientId: '239531826023-ibk10mb9p7ull54j55a61og5lvnjrff6.apps.googleusercontent.com'\n        }\n        ,\n        linkedin:{\n            clientId:'778mif8zyqbei7'\n        },\n        facebook:{\n            clientId:'1452782111708498'\n        }\n    }\n};\n\nvar configForProduction = {\n    loginUrl: '/login',\n    providers: {\n        google: {\n            clientId: '239531826023-3ludu3934rmcra3oqscc1gid3l9o497i.apps.googleusercontent.com'\n        }\n        ,\n        linkedin:{\n            clientId:'7561959vdub4x1'\n        },\n        facebook:{\n            clientId:'1653908914832509'\n        }\n\n    }\n};\nvar config ;\nif (window.location.hostname==='localhost') {\n    config = configForDevelopment;\n}\nelse{\n    config = configForProduction;\n}\n\n\nexport default config;\n","\nvar config = {\n  \"version\":\"0.1\",\n  \"debug\": true,\n  \"api\": {\n    \"host\":\"\",\n    \"port\": 6006,\n    \"path\": \"/api\"\n  },\n  \"wamp\": {\n    \"host\":\"\",\n    \"port\": 8080,\n    \"path\": \"/ws\",\n    \"realm\": \"realm1\"\n  },\n  \"maxUploadSize\": 104857600,\n  \"notificationAttentionTimeout\": 20\n}\n\nexport default config;\n","import {AuthService} from 'aurelia-auth';\nimport {Authentication} from 'aurelia-auth/authentication'\nimport {inject, LogManager} from 'aurelia-framework';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {Router} from 'aurelia-router';\n\nlet logger=LogManager.getLogger('access')\n\n@inject(AuthService, Authentication, EventAggregator, Router)\nexport class Access {\n  constructor(auth, authUtil, event, router) {\n    this.auth=auth;\n    this.util=authUtil;\n    this.event=event;\n    this.router = router;\n    logger.debug(`AuthUtil ${authUtil}`);\n  }\n\n  get token() {\n    return this.util.getToken()\n  }\n\n  hasRole(...requiredRoles) {\n    let token = this.auth.getTokenPayload();\n    if (! token) return false;\n    let roles=token.roles\n    if (! roles) return false;\n    return this.checkRoles(requiredRoles, roles);\n  }\n\n  checkRoles(requiredRoles, roles) {\n    return requiredRoles.reduce((prev, curr) => prev || roles.includes(curr), false);\n  }\n\n  get currentUser() {\n    if (this.auth.isAuthenticated()) {\n      return this.auth.getTokenPayload().email;\n    }\n  }\n\n  canEdit(userId) {\n    let token = this.auth.getTokenPayload();\n    if (this.checkRoles(['superuser', 'admin'], token.roles)) return true\n    else if (this.checkRoles(['user'], token.roles) && userId && userId == token.id ) return true;\n    return false;\n  }\n\n  get authenticated() {\n    return this.auth.isAuthenticated();\n  }\n\n  login(username, password) {\n    return this.auth.login({username, password})\n    .then(response=>{\n      if (response.error) {\n        let err=new Error('Invalid login');\n        err.error=response.error;\n        throw err;\n      } else {\n        logger.debug(\"success user logged in: \" + JSON.stringify(response));\n        this.event.publish('user-logged-in', {user:this.currentUser});\n      }\n    });\n\n  }\n\n  logout() {\n    this.auth.logout();\n    this.event.publish('user-logged-out');\n\n  }\n\n  signalState() {\n    if (this.authenticated) {\n      this.event.publish('user-logged-in', {user:this.currentUser});\n    } else {\n      this.event.publish('user-logged-out');\n    }\n  }\n\n  authenticate(name){\n      return this.auth.authenticate(name, false, null)\n      .then((response)=>{\n          logger.debug(\"auth response \" + JSON.stringify(response));\n      });\n  }\n\n}\n","import {HttpClient, json} from 'aurelia-fetch-client';\nimport {inject} from 'aurelia-framework';\nimport $ from 'bootstrap';\nimport {Configure} from 'lib/config/index';\n\n@inject(Configure, HttpClient)\nexport class ApiClient {\n  constructor(config, http) {\n    this.http=http;\n    this.apiPath=config.get('api.path');\n    this.baseUrl=http.baseUrl;\n    this._cache= new Map();\n  }\n\n  getUrl(r, query=null) {\n    return this.apiPath+'/'+r+(query?'?'+$.param(query):'');\n  }\n\n  post(resource, data) {\n    return this.http.fetch(this.getUrl(resource),\n    {method:'POST',\n    body:json(data)\n    })\n    .then(resp => resp.json())\n  }\n\n  delete(resource, id) {\n    return this.http.fetch(this.getUrl(resource)+'/'+id,\n      {method:'DELETE'})\n    .then(resp => resp.json());\n  }\n\n  patch(resource, data, id) {\n    return this.http.fetch(this.getUrl(resource+'/'+id),\n    {method: 'PATCH',\n    body:json(data)})\n    .then(resp => resp.json());\n  }\n\n  getIndex(resource, start) {\n    let url = this.getUrl(resource + '/index/' + encodeURIComponent(start));\n    return this.http.fetch(url).then(response => response.json());\n  }\n\n  getManyUnpagedCached(resource) {\n    let now = new Date()\n    if (this._cache.has(resource) && (now- this._cache.get(resource).ts) < 60*3600*1000) {\n      return Promise.resolve(this._cache.get(resource).data)\n    }\n    let url = this.getUrl(resource);\n    return this.http.fetch(url)\n      .then(response => response.json())\n      .then(data => {\n        this._cache.set(resource, {ts: new Date, data});\n        return data\n      });\n  }\n\n  getManyUnpaged(resource) {\n    let url = this.getUrl(resource);\n    return this.http.fetch(url)\n      .then(response => response.json())\n      .then(data => {\n        return data\n      });\n  }\n\n  getMany(resource, page=1, pageSize=25, sort, extra) {\n    let query={page:page, page_size:pageSize,sort:sort};\n    if (extra) {\n      for (let k in extra)\n        if (extra.hasOwnProperty(k)) query[k]=extra[k];\n    }\n    const url=this.getUrl(resource, query);\n    return this.http.fetch(url)\n      .then(response => response.json())\n      .then(data => {let lastPage=Math.ceil(data.total / data.page_size);\n                    return {data:data.items, lastPage:lastPage}})\n  }\n\n  search(query, page=1, pageSize=25) {\n    return this.getMany('search/'+encodeURIComponent(query), page, pageSize)\n  }\n\n  authorBooks(id, filter=null, page=1, pageSize=34, sort) {\n    return this.getMany('ebooks/author/'+id, page, pageSize, sort, filter?{filter:encodeURIComponent(filter)}:null);\n  }\n\n  getOne(resource, id) {\n    let url=this.getUrl(resource+'/'+ id)\n    return this.http.fetch(url)\n      .then(response => response.json());\n  }\n\n  checkUpload(fileInfo) {\n    return this.post('upload/check', fileInfo)\n      .then(data => {\n        if (data.error) throw new Error(data.error);\n      });\n  }\n\n  upload(formData) {\n    return this.http.fetch(this.getUrl('upload'), {method:'post', body: formData})\n      .then( resp => resp.json())\n  }\n\n  addUploadToEbook(ebookId, uploadId, quality) {\n    return this.post(`ebooks/${ebookId}/add-upload`, {upload_id:uploadId, quality});\n  }\n\n  getCover(resource, id) {\n    let url =  this.getUrl(resource+'/'+id+'/cover')\n    return this.http.fetch(url)\n    .then(r => r.blob())\n  }\n}\n","export class ApplicationState {\n  constructor() {\n  this.token='1234';\n  this.userName='';\n}\n}\n","import {LogManager, inject} from 'aurelia-framework';\nimport {Configure} from  'lib/config/index'\nimport {EventAggregator} from 'aurelia-event-aggregator';\n\nlet logger=LogManager.getLogger('notifications');\nconst MAX_SIZE=20;\n\n@inject(Configure, EventAggregator)\nexport class Notification {\n\n  constructor(config, event) {\n    this.event = event;\n    this._observers = new Set();\n    this._ns=[];\n    this._details=new Map()\n    /*\n    if (config.get('debug')) {\n      this._ns=['aaaaa'];\n      this._details.set('aaaaa',{text:'Converted ebook TEST ',\n            'task': 'convert',\n            'start': new Date(),\n            'status':'success',\n            'result': 3});\n    }\n    */\n  }\n\n  addObserver(o) {\n    this._observers.add(o)\n    return () => this._observers.delete(0);\n    }\n\n  updateObservers(action, status) {\n    this._observers.forEach(o => o(action, status));\n  }\n\n  start(taskId, taskInfo) {\n\n    this._ns.unshift(taskId);\n    taskInfo.start=new Date();\n    this._details.set(taskId, taskInfo);\n    if (this._ns.length > MAX_SIZE) {\n      let k = this._ns.pop();\n      this._details.delete(k);\n    }\n    this.updateObservers('start');\n  }\n\n  update(taskId, obj) {\n    if (this._details.has(taskId)) {\n      let data = this._details.get(taskId);\n      Object.assign(data, obj);\n      this.updateObservers('update', obj.status);\n      logger.debug(`Task updated ${taskId}`);\n      let task = data.task;\n      if (task) {\n        if (obj.status === 'success') this.event.publish(`${task}-ready`, {taskId, result: obj.result, data});\n        else if (obj.status === 'error') this.event.publish(`${task}-error`, {taskId, error: obj.error, data});\n      }\n\n    } else {\n      logger.warn(`Update for uknown task ${taskId}`);\n    }\n\n  }\n\n  markDone(taskId) {\n    if (this._details.has(taskId)) {\n      this._details.get(taskId).done = true;\n    }\n  }\n\n  get items() {\n    let a = [];\n    for (let taskId of this._ns) {\n      let notif = this._details.get(taskId);\n      a.push(notif);\n    }\n    return a;\n  }\n\n  get empty() {\n    return ! this._ns || this._ns.length === 0\n  }\n\n}\n","import {Notification} from 'lib/notification';\nimport {Access} from 'lib/access';\nimport {inject,LogManager} from 'aurelia-framework';\nimport {Configure} from 'lib/config/index';\nimport {EventAggregator} from 'aurelia-event-aggregator';\n\nimport autobahn from 'autobahn';\n\nconst logger = LogManager.getLogger('ws-client');\n\n@inject(Configure, Notification, EventAggregator, Access)\nexport class WSClient {\n  conn = null;\n  session = null;\n  constructor(config, notif, event, access) {\n    this.notif = notif;\n    this.access = access;\n    this.config = config;\n\n    window.AUTOBAHN_DEBUG = true;\n\n    event.subscribe('user-logged-in', (evt) => this.connect(evt.user));\n    event.subscribe('user-logged-out', () => this.disconnect());\n\n  }\n\n  connect(userEmail) {\n    if (this.conn) {\n      logger.warn('Connection already exists');\n    }\n    let connUrl = `ws://${this.config.get('wamp.host', window.location.hostname)}:${this.config.get('wamp.port')}${this.config.get('wamp.path')}`;\n    this.conn = new autobahn.Connection({\n      url: connUrl,\n      realm: this.config.get('wamp.realm'),\n      authmethods: [\"ticket\"],\n      authid: userEmail,\n      onchallenge: (session, method, extra) => this.onChallenge(session, method, extra)\n    });\n    logger.debug('WAMP connection requested');\n    this.conn.onopen = (session, details) => this.onConnectionOpen(session, details);\n    this.conn.onclose = this.onConnectionClose;\n    this.conn.open();\n  }\n\n  get isConnected() {\n    return (this.session !== null)\n  }\n\n  disconnect() {\n    if (this.conn) {\n      this.conn.close();\n      logger.debug('Disconnected WS connection');\n      this.conn = null;\n      this.session = null;\n    }\n  }\n\n  receiveNotification(args, kwargs, options) {\n    logger.debug(`Notification ${JSON.stringify(args)}, ${JSON.stringify(kwargs)}`);\n    this.notif.update(args[0], kwargs);\n  }\n\n  onChallenge(session, method, extra) {\n    logger.debug(`Authentication required, method ${method}`);\n    if (method === 'ticket') {\n      return this.access.token;\n    } else {\n      throw new Error('invalid auth method');\n    }\n\n  }\n\n  onConnectionOpen(session, details) {\n    logger.debug('WAMP connection opened : ' + JSON.stringify(details));\n    this.session = session\n    session.subscribe('eu.zderadicka.asexor.task_update', (args, kwargs, options) =>\n        this.receiveNotification(args, kwargs, options))\n      .then(sub => logger.debug('WAMP subscribed to notifications'),\n        err => logger.error('WAMP Failed to subscribe to notifications ' + JSON.stringify(err)));\n\n  }\n\n  onConnectionClose(reason, details) {\n    logger.warn(`WAMP connection closed ${reason}`);\n    this.conn=null;\n    this.session=null;\n  }\n\n  extractMeta(fileName, originalFileName=null, proposedMeta={}) {\n    if (! this.isConnected) {\n      alert('WebSocket is not connected, reload application!');\n      return;\n    }\n    return this.session.call('eu.zderadicka.asexor.run_task', ['metadata',fileName, proposedMeta])\n    .then(taskId => {\n      this.notif.start(taskId,\n        {\n        text:`Extract Metadata from ${originalFileName || fileName}`,\n        status:\"submitted\",\n        task:\"metadata\",\n        taskId,\n        file: fileName,\n        originalFileName\n      });\n      return taskId;\n    });\n  }\n\n  convertSource(source, format, ebook) {\n    if (! this.isConnected) {\n      alert('WebSocket is not connected, reload application!');\n      return;\n    }\n    return this.session.call('eu.zderadicka.asexor.run_task', ['convert', source.id, format])\n      .then(taskId => {\n        this.notif.start(taskId,\n          {\n          text:`Convert ebook ${ebook.title}: from ${source.format} to ${format}`,\n          status:\"submitted\",\n          task:\"convert\",\n          taskId,\n          sourceId: source.id,\n          ebookId: ebook.id\n        });\n        return taskId;\n      })\n  }\n\n}\n","import {BindingEngine, inject, LogManager} from 'aurelia-framework';\nimport {Container} from 'aurelia-dependency-injection';\n\nlet logger = LogManager.getLogger('ebook');\n\nexport class Ebook {\n\n  _editableProps=['title', 'authors[]', 'genres[]', 'language.id', 'series', 'series_index'];\n\n  constructor(ebook) {\n    let bindingEngine = Container.instance.get(BindingEngine);\n    if (ebook) Object.assign(this, ebook);\n\n    this._disposers=[];\n    this._changed = new Set();\n\n    let bind = (prop, asArray) => {\n      let observer;\n      let obj = this;\n      let parts=prop.split('.');\n      let propName=parts[0];\n\n      while (parts.length >1) {\n        let disp =  bindingEngine.propertyObserver(obj, parts[0])\n          .subscribe((n,o) => this.changed(propName));\n        this._disposers.push(disp);\n        let newObj = obj[parts[0]];\n        if (!newObj) {\n          newObj = {};\n          obj[parts[0]] = newObj;\n        }\n        obj = newObj;\n        prop = parts[1];\n        parts.shift();\n      }\n\n      if (asArray) {\n        if (!obj[prop]) obj[prop] = [];\n        observer = bindingEngine.collectionObserver(obj[prop]);\n      } else {\n        observer=bindingEngine.propertyObserver(obj, prop);\n      }\n      let disp = observer.subscribe((n,o) => this.changed(propName,n,o));\n      this._disposers.push(disp);\n    }\n\n    for (let [prop, asArray] of this.editableProps2)\n      bind(prop, asArray);\n  }\n\n  get editableProps() {\n    return this._editableProps.map(p => {\n      p = p.split('.')[0];\n      return p.endsWith('[]')? p.slice(0,-2):p;\n    })\n  }\n\n  get editableProps2() {\n    return this._editableProps.map(p => {\n      return p.endsWith('[]')? [p.slice(0,-2), true]:[p, false];\n    })\n  }\n\n  isNew() {\n    return ! this.id ;\n  }\n\n  changed(prop, n, o) {\n    logger.debug('Property changed '+prop);\n    this._changed.add(prop);\n  }\n\n  dispose() {\n    this._disposers.forEach(d => d.dispose());\n  }\n\n  validate(addError) {\n    // Title\n    if (!this.title) addError('title', 'Title is mandatory!');\n    if (this.title && this.title.length > 256) addError('title', 'Title too long');\n    // Language\n    if ( !this.language || !this.language.id) addError('language', 'Language is mandatory');\n    // Series\n    if ( this.series && this.series.title && ! this.series_index)\n      addError('series', 'If series title is present then series index is mandatory');\n    if ( !(this.series && this.series.title) &&  this.series_index)\n      addError('series', 'If series index is present then series title is mandatory');\n    if (this.series && this.series.title && this.series.title.length > 256)\n      addError('series', 'Series title too long');\n    if (this.series_index && ! Number.isInteger(this.series_index) && ! this.series_index.match(/^\\d+$/))\n      addError('series', 'Series index must be numeric');\n    // Authors\n    if (this.authors && this.authors.length > 20) addError('authors', 'Too many authors');\n    // Genres\n    if (this.genres && this.genres.length > 10) addError('genres', 'Too many genres');\n\n  }\n\n  prepareData() {\n    let data = {}\n\n    let shrink = function(obj) {\n      if  (!obj) return null;\n      if (obj.hasOwnProperty('id') && obj.id) {\n        return {id:obj.id}\n      } else {\n        let newObj = {}\n        for (let prop of Object.keys(obj)) {\n          if (prop !=='id' && obj[prop]) newObj[prop] = obj[prop]\n        }\n        if (Object.keys(newObj).length === 0) return null;\n        return newObj;\n      }\n    };\n\n      let shrinkList = function(l) {\n        if (!l) return [];\n        return l.map(shrink).filter(x => x);\n      }\n\n      let compareObjects = function(o1, o2) {\n        return JSON.stringify(o1) === JSON.stringify(o2);\n      }\n\n    for (let prop of this.editableProps) {\n      if (this.isNew() || this._changed.has(prop)) {\n        let val = this[prop];\n        if (Array.isArray(val))\n          val = shrinkList(val);\n        else if (typeof val === 'object')\n          val = shrink(val)\n        data[prop] = val;\n      }\n    }\n    /*\n    if (isNew || this.ebook.title !== this.originalEbook.title) data.title = this.ebook.title;\n    if (isNew || this.ebook.language.id !== this.originalEbook.language.id)\n      data.language = shrink(this.ebook.language);\n\n    if (isNew || this.ebook.series_index != this.originalEbook.series_index) data.series_index = this.ebook.series_index;\n\n    let newSeries = shrink(this.ebook.series)\n    if (isNew || ! compareObjects(newSeries, shrink(this.originalEbook.series)))\n      data.series = newSeries;\n\n    let newAuthors = shrinkList(this.ebook.authors);\n    if (isNew || ! compareObjects(newAuthors, shrinkList(this.originalEbook.authors)))\n      data.authors = newAuthors;\n\n    let newGenres =  shrinkList(this.ebook.genres)\n    if (isNew || ! compareObjects(newGenres, shrinkList(this.originalEbook.genres)))\n      data.genres = newGenres;\n\n    */\n\n    if (! this.isNew() && Object.keys(data).length) {\n      data.id = this.id;\n      data.version_id = this.version_id;\n    }\n\n    logger.debug(`New data : ${JSON.stringify(data)}`);\n    return data;\n\n  }\n\n}\n","import {inject, bindable, computedFrom, LogManager} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nconst logger = LogManager.getLogger('search');\n\n@inject(ApiClient)\nexport class Author {\n  _loader;\n  @bindable filter;\n  author;\n\n  constructor(client) {\n    this.client=client;\n  }\n\n  activate(params)  {\n    logger.debug('Author activated with '+JSON.stringify(params));\n    this.id=decodeURIComponent(params.id);\n    this.client.getOne('authors', params.id). then(data => {this.author=data; logger.debug('Loaded author'+JSON.stringify(data))})\n\n    this.updateLoader()\n  }\n\n  filterChanged() {\n    logger.debug('Filter changed to '+ this.filter);\n    this.updateLoader()\n  }\n\n  updateLoader() {\n    this._loader = this.client.authorBooks.bind(this.client, this.id, this.filter);\n  }\n\n  @computedFrom('_loader')\n  get loader() {\n    return this._loader;\n  }\n\n}\n","import {LogManager, inject, bindable} from 'aurelia-framework';\nimport {Router, activationStrategy} from 'aurelia-router';\nimport $ from 'jquery';\nimport {ApiClient} from 'lib/api-client';\nimport {Access} from 'lib/access';\nimport {Ebook} from 'models/ebook';\nimport {DialogService} from 'aurelia-dialog';\nimport {ConfirmDialog} from 'components/confirm-dialog';\n\nlet logger = LogManager.getLogger('ebook-edit')\n\n@inject(ApiClient, Router, Access, DialogService)\nexport class EditEbook {\n  ebook;\n  originalEbook;\n  _languages;\n  _genres;\n  @bindable _series;\n  _seriesSelected;\n\n  constructor(client, router, access, dialog) {\n    this.client = client;\n    this.router = router;\n    this.access = access;\n    this.dialog = dialog;\n  }\n\n/*\n * It does not help with pagination back problem\n\n  determineActivationStrategy(){\n    return activationStrategy.replace;\n    //return activationStrategy.invokeLifecycle;\n  }\n*/\n\n  canActivate(params) {\n    if (params.id !== undefined) {\n    return this.client.getOne('ebooks', params.id)\n      .then(b => {\n        this.ebook=new Ebook(b);\n        this._series = b.series ? b.series.title : undefined;\n        logger.debug(`Ebook data ${JSON.stringify(b)}`);\n        return this.access.canEdit(b.created_by);\n      })\n      .catch(err => { logger.error(`Failed to load ${err}`);\n                      return false;})\n\n    } else {\n      this.ebook = new Ebook();\n      this._series = undefined;\n      return true;\n    }\n\n  }\n  activate(params) {\n    logger.debug(`Activated with ${JSON.stringify(params)}`)\n    let promises = [];\n\n    promises.push(\n    this.client.getManyUnpagedCached('languages')\n      .then( data => {\n      this._languages = data;\n      logger.debug(`Got languages ${JSON.stringify(this._languages)}`)\n      }\n      ),\n    this.client.getManyUnpagedCached('genres')\n      .then(data => this._genres = data)\n    );\n\n    if (params.upload) {\n      promises.push(\n          this.client.getOne('uploads-meta', params.upload)\n          .then(upload=> {\n            this.uploadId=upload.id;\n            this.meta = upload.meta;\n          })\n          .catch(err=> logger.error('Upload fetch error: '+err))\n      )\n    }\n\n    return Promise.all(promises).then(() => {\n      logger.debug('Try to use metada '+ JSON.stringify(this.meta));\n      if (this.meta) this.prefill()});\n  }\n\n  deactivate() {\n    if (this.ebook) this.ebook.dispose();\n  }\n\n  prefill() {\n    if (this.meta.title) this.ebook.title = this.meta.title;\n    if (this.meta.authors && this.meta.authors.length) {\n      this.ebook.authors=this.meta.authors;\n    }\n    if (this.meta.series && this.meta.series.title) {\n      this.ebook.series =  this.meta.series;\n      this._series = this.meta.series.title;\n      this.ebook.series_index = this.meta.series_index;\n    }\n\n    if (this.meta.language && this.meta.language.id) {\n      this.ebook.language = {id:this.meta.language.id};\n    }\n\n    if (this.meta.genres && this.meta.genres.length) {\n      this.ebook.genres = this.meta.genres.filter(i => i.id);\n    }\n  }\n\n  _seriesChanged() {\n    logger.debug(`Series is ${this._series} selected ${JSON.stringify(this._seriesSelected)}`);\n    if (this._seriesSelected) this.ebook.series = this._seriesSelected\n    else this.ebook.series = {title: this._series};\n  }\n\n  save() {\n    //logger.debug(`Saving ${JSON.stringify(this.ebook)}`);\n    this.error=undefined;\n\n    if (this.validate()) {\n      let data = this.ebook.prepareData();\n      if (!data || ! Object.keys(data).length) {\n        this.error={error:'No changes to save'};\n        return\n      }\n      let result;\n      if (this.ebook.id) {\n        result = this.client.patch('ebooks', data, this.ebook.id)\n      } else {\n        result = this.client.post('ebooks', data);\n      }\n\n      result.then(res => {\n        if (res.error) {\n          this.error={error:res.error, errorDetail:res.error_details}\n        } else if (res.id) {\n          let action = this.uploadId ? this.client.addUploadToEbook(res.id, this.uploadId, this.meta.quality || null) : Promise.resolve({})\n           action.then(res2 => {\n              if (res2.error) this.error = {\n                error: res2.error,\n                errorDetail: res2.error_details }\n              else\n                this.router.navigateToRoute('ebook', {id:res.id});\n              })\n            .catch(err => this.error={error:\"Server error attaching source\", errorDetail:err});\n\n        } else {\n          this.error = {error:'Invalid respose', errorDetail: 'Ebook ID is missing'}\n        }\n      })\n      .catch(err => this.error={error:'Request failed', errorDetail:err})\n\n\n    } else {\n      logger.debug(`Validation fails`)\n    }\n  }\n\n  validate() {\n    $('.has-error').removeClass('has-error');\n    $('.help-block').remove();\n    let errors = [];\n\n    let addError = function (what,err) {\n      errors.push(err);\n      let grp=$(`#${what}-input-group`);\n      grp.addClass('has-error');\n      $('<span>').addClass('help-block').text(err).appendTo(grp);\n\n    }\n    this.ebook.validate(addError);\n    return errors.length === 0\n  }\n\n  cancel() {\n    if (this.ebook.id) {\n      this.router.navigateToRoute('ebook', {id:this.ebook.id});\n    } else {\n      this.router.navigate('welcome')\n    }\n  }\n\n  get seriesLoader() {\n    return start => this.client.getIndex('series', start);\n  }\n\n  canDelete() {\n    return this.ebook.id && this.access.canEdit(this.ebook.created_by);\n  }\n\n  delete() {\n    this.error=undefined;\n    this.dialog.open({viewModel:ConfirmDialog, model: {action:'Delete', message:`Do you want to delete ebook ${this.ebook.title}`}})\n    .then(response => {\n      if (!response.wasCancelled && this.ebook.id) {\n        this.client.delete('ebooks', this.ebook.id)\n        .then(res => {\n          if (res.error) {\n            this.error={error:res.error, errorDetail:res.error_details}\n          } else {\n            this.router.navigateToRoute('welcome');\n          }\n        })\n        .catch(err=> this.error={error:'Delete error', errorDetail:err})\n\n      }\n    });\n\n  }\n\n}\n","import {inject} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nimport {LogManager} from 'aurelia-framework';\nimport {Access} from 'lib/access';\nimport {DialogService} from 'aurelia-dialog';\nimport {ConfirmDialog} from 'components/confirm-dialog';\nimport {WSClient} from 'lib/ws-client';\nimport {EventAggregator} from 'aurelia-event-aggregator';\n\nlet logger = LogManager.getLogger('ebooks');\n\n@inject(ApiClient, WSClient, Access, DialogService, EventAggregator)\nexport class Ebook {\n  ebook\n  constructor(client, ws, access, dialog, event ) {\n    this.client=client;\n    this.ws = ws;\n    this.access=access;\n    this.dialog =  dialog;\n    this.event = event;\n    this.token = access.token;\n    this.canDownload=access.hasRole('user');\n    this.canConvert=access.hasRole('user');\n    this.cover = new Image();\n    this.cover.onload = function() {\n        URL.revokeObjectURL(this.src);\n      }\n    this.subscribeConvertEvents();\n  }\n\n  subscribeConvertEvents() {\n    let deactivateSource = sourceId => {\n      if (this.ebook.sources)\n        this.ebook.sources.filter(s => s.id === sourceId)\n          .forEach(s => {\n            if (s.active) --s.active;\n          })\n    }\n    this.event.subscribe('convert-ready', msg => {\n      if (this.ebook && this.ebook.id === msg.data.ebookId) {\n      deactivateSource(msg.data.sourceId);\n      this.updateConverted();\n    }\n    });\n    this.event.subscribe('convert-error', msg => {\n      if (this.ebook && this.ebook.id === msg.data.ebookId) {\n      deactivateSource(msg.data.sourceId);\n      this.ebook.sources.filter(s => s.id === msg.data.sourceId)\n        .forEach(s => s.error = msg.error);\n    }\n      logger.error('Conversion failed due to '+msg.error);\n    })\n  }\n\n\n  get isEditable() {\n    return this.ebook && this.access.canEdit(this.ebook.created_by);\n  }\n\n  canActivate(params) {\n    return this.client.getOne('ebooks', params.id)\n      .then(b => {\n        this.ebook=b;\n        return this.client.getCover('ebooks', b.id)\n          .then (blob => {\n            this.cover.src = URL.createObjectURL(blob);\n            return true })\n          .catch(err => {\n            logger.warn(`Cannot load cover for ebook ${b.id}: ${err}`);\n            return true\n          })\n        return true;})\n      .catch(err => {\n        logger.error(`Failed to load ${err}`);\n        return false;\n      });\n  }\n\n  activate(params) {\n    this.updateConverted();\n  }\n\n  updateConverted() {\n    this.client.getManyUnpaged(`ebooks/${this.ebook.id}/converted`)\n    .then(data => this.convertedSources = data.items)\n    .catch(err => logger.error('Cannot get converted sources',err));\n  }\n\n  attached() {\n    if (this.cover.src)\n      document.getElementById('cover-holder').appendChild(this.cover);\n  }\n\n  get searchString() {\n    let s=''\n    if (this.ebook.authors)\n      s += this.ebook.authors.slice(0,2).map(a=> a.first_name? a.first_name+' '+a.last_name: a.last_name).join(' ');\n    s += ' '+ this.ebook.title;\n    return encodeURIComponent(s);\n  }\n\n  canDeleteSource(source) {\n    return this.access.canEdit(source.created_by);\n  }\n\n  deleteSource(source) {\n    this.dialog.open({\n        viewModel: ConfirmDialog,\n        model: {\n          action: 'Delete',\n          message: `Do you want to delete ${source.format} file from ebook ${this.ebook.title}?`\n        }\n      })\n      .then(resp => {\n        if (!resp.wasCancelled) {\n        this.client.delete('sources', source.id)\n          .then(res => {\n            if (res.error) {\n              logger.error('Source delete failed: ' + res.error + ' '+ res.error_details);\n              alert('Cannot delete: '+ res.error);\n            } else {\n              let idx = this.ebook.sources.findIndex(x => x === source)\n              if (idx >= 0) this.ebook.sources.splice(idx, 1);\n              this.updateConverted();\n            }\n          })\n          .catch(err => {\n            logger.error('Server error: ' + err);\n          })\n        }\n      });\n  }\n\n  get convertSource() {\n    return (format,source) => {\n      source.error=undefined;\n      if (format != source.format) {\n        this.ws.convertSource(source, format, this.ebook).then(\n          taskId => {\n            if (! source.active) source.active=1;\n            else source.active += 1;\n            logger.debug(`Converting ${JSON.stringify(source)} to ${format} in task ${taskId}`);\n          })\n          .catch(err => {\n            alert('Conversion submission error');\n            logger.error('Conversion submission error: '+JSON.stringify(err));\n          });\n        };\n      }\n  }\n\n\n}\n","import {inject, bindable} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nimport {LogManager} from 'aurelia-framework';\nlet logger = LogManager.getLogger('ebooks');\n\n@inject(ApiClient)\nexport class Ebooks {\n  \n  constructor(client) {\n    this.client=client\n  }\n  activate(params) {\n    logger.debug(`History State ${JSON.stringify(history.state)}`);\n  }\n\n  get loader() {\n    return this.client.getMany.bind(this.client, 'ebooks');\n  }\n\n}\n","import {Access} from 'lib/access';\nimport {inject, LogManager, bindable} from 'aurelia-framework';\n\nlet logger=LogManager.getLogger('login');\n\n@inject(Access)\nexport class Login{\n  title = 'Login';\n  @bindable email='';\n  @bindable password='';\n  error=false;\n\n    constructor(access){\n        this.access = access;\n    };\n\n    login(){\n        return this.access.login(this.email,this.password)\n        .then( () => this.error = undefined)\n        .catch(err=>{\n            this.error={error:'Login Failed', errorDetail: (err.error? err.error: err)};\n            logger.error(\"Login failure: \"+err);\n            //todo: get it from auth config?\n            //this.router.navigate('login')\n        });\n    };\n\n    canDeactivate() {\n      return ! this.error;\n    }\n\n\n}\n","import {inject, computedFrom, LogManager} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nconst logger = LogManager.getLogger('search');\n\n@inject(ApiClient)\nexport class Search {\n  _loader\n  constructor(client) {\n    this.client=client;\n  }\n\n  activate(params)  {\n    logger.debug('Search actited with '+JSON.stringify(params));\n    this.query=decodeURIComponent(params.query);\n    this._loader = this.client.search.bind(this.client, this.query);\n  }\n\n  bind(ctx, newCtx) {\n    logger.debug('Search bind');\n  }\n\n  @computedFrom('_loader')\n  get loader() {\n    return this._loader;\n  }\n}\n","import {inject, LogManager, computedFrom} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nimport {Router} from 'aurelia-router';\n\nlet logger = LogManager.getLogger('upload-result');\n\n@inject(ApiClient, Router)\nexport class UploadResult {\n  meta;\n  metaId;\n  id;\n  file;\n  ebook;\n  ebooksCandidates;\n  ebooksSearched;\n  cover=new Image();\n  error;\n  constructor(client, router) {\n    this.client=client;\n    this.router = router;\n    // has to revoke object URL to release blob\n    this.cover.onload = function() {\n        URL.revokeObjectURL(this.src);\n      }\n\n  }\n\n  canActivate(model) {\n    logger.debug(`Activated with ${JSON.stringify(model)}`);\n    this.id = model.id;\n    return this.client.getOne('uploads-meta', model.id)\n    .then(meta => {\n      this.meta = meta.meta;\n      this.metaId = meta.id;\n      this.file = meta.load_source;\n      logger.debug(`Got meta ${JSON.stringify(meta)}`);\n      this.client.getCover('uploads-meta', model.id)\n        .then(blob => this.cover.src = URL.createObjectURL(blob))\n\n      return meta.meta\n    })\n    .then(meta => {\n      var authors = meta.authors ? meta.authors.map(a => a.first_name ? a.first_name + ' ' + a.last_name : a.last_name ).join(' ') : null;\n      var search=meta.title ? meta.title : '';\n      search = meta.series ? search + ' '+ meta.series.title : search\n      search = authors ? authors + ' ' + search : search;\n      logger.debug(`Searching for ebooks: ${search}`);\n      return this.client.search(search, 1, 5).\n        catch(err => {\n          logger.error('Search failed: '+err);\n          return {};\n        });\n      })\n    .then(result => {\n      logger.debug(`Found ${result.data}`);\n      if (result.data && result.data.length) this.ebooksCandidates=result;\n      return true;\n      })\n    .catch(err => {\n      logger.error(`Upload meta error ${err}`);\n      return false});\n\n  }\n\n  attached() {\n    if (this.cover.src)\n      document.getElementById('cover-holder').appendChild(this.cover);\n  }\n\n  createNew() {\n    this.router.navigateToRoute('ebook-create', {upload: this.id});\n  }\n\nget addToEbook() {\n  return ebookId => {\n    this.client.addUploadToEbook(ebookId, this.id, this.meta.quality || null)\n      .then(res => {\n        if (res.error) this.error = {\n          error: res.error,\n          errorDetail: res.error_details\n        }\n        else {\n          this.router.navigateToRoute('ebook', {\n            id: ebookId\n          });\n        }\n      })\n      .catch(err => this.error = {\n        error: 'Server error',\n        errorDetail: err\n      });\n  }\n}\n\nget search() {\n  return ({query}) => {\n    this.ebooksSearched = null;\n    this.client.search(query, 1, 5)\n    .then(res => {\n      this.ebooksSearched = res;\n\n    })\n    .catch(err => this.error ={error: 'Search error', errorDetail:err});\n  }\n}\n\n}\n","import {LogManager, inject, bindable} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\nimport {Configure} from 'lib/config/index';\nimport {WSClient} from 'lib/ws-client';\nimport {EventAggregator} from 'aurelia-event-aggregator';\nimport {Notification} from 'lib/notification';\nimport {Router} from 'aurelia-router';\n\nlet logger=LogManager.getLogger('upload');\n\nfunction hex(buffer) {\n  var hexCodes = [];\n  var view = new DataView(buffer);\n  for (var i = 0; i < view.byteLength; i += 4) {\n    // Using getUint32 reduces the number of iterations needed (we process 4 bytes each time)\n    var value = view.getUint32(i)\n    // toString(16) will give the hex representation of the number without padding\n    var stringValue = value.toString(16)\n    // We use concatenation and slice for padding\n    var padding = '00000000'\n    var paddedValue = (padding + stringValue).slice(-padding.length)\n    hexCodes.push(paddedValue);\n  }\n\n  // Join all the hex strings into one\n  return hexCodes.join(\"\");\n}\n\n@inject(ApiClient, WSClient, Configure, EventAggregator, Notification, Router)\nexport class Upload {\n  fileOK=false;\n  uploading=false;\n  checking=false;\n  uploadError=null;\n  uploadId=null;\n  @bindable rating = null;\n\n  constructor(client, wsClient, config, event, notif, router) {\n    this.client=client;\n    this.wsClient=wsClient;\n    this.config=config;\n    this.event = event;\n    this.notif = notif;\n    this.router = router;\n  }\n  upload() {\n    this.fileOK=false;\n    this.checking=false;\n    this.uploading =  true;\n    logger.debug(`Uploading file`);\n    let formData= new FormData(document.getElementById('file-upload-form'))\n    this.client.upload(formData)\n      .then(data => {\n        if (data.error) {\n          this.uploadError=`Upload error: ${data.error}`;\n          logger.error(`Upload error: ${data.error}`);\n          this.uploading = false;\n        } else {\n          logger.debug(`File uploaded ${JSON.stringify(data)}`);\n          let origName =  document.getElementById('file-input').value;\n          this.wsClient.extractMeta(data.file, origName, {quality:this.rating})\n            .then(taskId => {\n              logger.debug(`Task ID ${taskId} for file ${data.file}`);\n              this.event.subscribe('metadata-ready', result => {\n                if (taskId === result.taskId) {\n                  this.uploading = false;\n                  this.notif.markDone(taskId);\n                  this.router.navigateToRoute('upload-result', {id:result.result});\n\n                }\n              });\n              this.event.subscribe('metadata-error', result => {\n                if (taskId === result.taskId) {\n                this.uploading = false;\n                this.uploadError = `Error in metadata: ${result.error}`;\n              }\n              });\n            })\n            .catch(err => {\n              logger.error(`Error when extracting metadata: ${err}`);\n              this.uploading = false;\n              this.uploadError = `Error in metadata: ${err}`;\n            });\n        }\n      })\n  }\n\n  checkFile() {\n    this.checking=true;\n    this.uploading=false;\n    this.fileOK=false;\n    this.uploadError=null;\n    this.uploadId=null;\n\n    let files=document.getElementById('file-input');\n    if (files.files.length < 1) {\n      this.checking=false;\n      return;\n    }\n    let file=files.files[0]\n    if (file.size > this.config.get('maxUploadSize')) {\n      this.uploadError='Are you mad? This file is just too big for ebook!';\n      this.checking=false;\n      return\n    }\n    var fileInfo = {\n      mime_type:file.type,\n      size:file.size,\n      hash: null\n    }\n    let reader=new FileReader()\n    reader.onload = () => crypto.subtle.digest(\"SHA-1\", reader.result)\n      .then(val => {\n        fileInfo.hash=hex(val);\n        logger.debug('File info '+JSON.stringify(fileInfo));\n        this.client.checkUpload(fileInfo)\n          .then( () => {\n            this.checking=false;\n            this.fileOK=true;\n          })\n          .catch( err => {\n            this.checking=false;\n            logger.error(`File check error`, err);\n            this.uploadError=`Check error: ${err}`\n          })\n      });\n    reader.readAsArrayBuffer(file);\n    logger.debug(`Checking file ${file.name}`)\n  }\n}\n","export class Welcome {\n  \n}\n","import {inject} from 'aurelia-framework';\nimport {ApiClient} from 'lib/api-client';\n\n@inject(ApiClient)\nexport class TestPage {\n  country;\n  series;\n  seriesSelected;\n  ebook;\n\n  constructor(client) {\n    this.client=client;\n  }\n\n  get seriesSelectedRepr() {\n    return JSON.stringify(this.seriesSelected);\n  }\n\n  get loaderSeries() {\n    return start => this.client.getIndex('series', start);\n  }\n\n  get loaderEbooks() {\n    return start => this.client.getIndex('ebooks', start);\n  }\n\n  get loaderAuthors() {\n    return start => this.client.getIndex('authors', start);\n  }\n\n  getFullName(item) {\n    return item.first_name ? item.last_name + ', ' + item.first_name : item.last_name\n  }\n}\n","import {bindable, bindingMode, inject, LogManager, computedFrom} from 'aurelia-framework';\nimport $ from 'jquery';\nimport diacritic from 'diacritic'; // npm:diacritic package\n\nlet logger = LogManager.getLogger('autocomplete');\n\nconst CACHE_DURATION = 60000; //ms\n\nfunction startsWith(string, start) {\n  string = diacritic.clean(string).toLowerCase();\n  start = diacritic.clean(start).toLowerCase()\n  return string.startsWith(start);\n}\n\n@inject(Element)\nexport class Autocomplete {\n  @bindable({\n    defaultBindingMode: bindingMode.twoWay\n  }) value; // value of input\n  @bindable({\n    defaultBindingMode: bindingMode.twoWay\n  }) selectedValue; // this will be selected value from suggestions - full value\n  @bindable loader = []; // can be either array of suggestions or function returning Promise resolving to such array\n  @bindable minLength = 1; // min length of input to start search and suggest\n  @bindable valueKey = null; // name of value property, null means use use whole suggestion\n  @bindable suggestionTemplate = null; // template to display a suggestion - if none string value of suggestion is shown\n  @bindable additionalClass; // additional classes for input control\n  @bindable placeholder = ''; // placeholder for input control\n\n  _suggestions = [];\n  _selected = null;\n  _suggestionsShown = false;\n  _ignoreChange = false;\n  _cache;\n  _attached = false;\n\n  constructor(elem) {\n    this.elem = elem;\n  }\n\n  valueChanged() {\n    if (!this._attached) return;\n\n    if (this._ignoreChange) {\n      this._ignoreChange = false;\n      return;\n    }\n    this.selectedValue = undefined;\n    if (!this.value || this.value.length < this.minLength) {\n      this._suggestions = [];\n      this.hideSuggestions();\n      return;\n    }\n\n    this.getSuggestions(this.value).then(suggestions => {\n      this._suggestions = suggestions;\n      if (this._suggestions.length) {\n        this.showSuggestions();\n      }\n\n    });\n  }\n\n  attached() {\n    this.suggestionsList = $('div.autocomplete-suggestion', this.elem)\n    this._attached = true;\n    this.hideSuggestions()\n  }\n\n  getSuggestionValue(item) {\n    if (!this.valueKey) {\n      return item;\n    } else if (typeof this.valueKey === 'string') {\n      return item[this.valueKey];\n    } else if (typeof this.valueKey === 'function') {\n      return this.valueKey(item)\n    }\n  }\n\n  getSuggestions(forValue) {\n    logger.debug(`Get suggestions for ${forValue}`);\n    if (Array.isArray(this.loader)) {\n      return Promise.resolve(this.loader.filter(item =>\n        startsWith(this.getSuggestionValue(item), forValue)));\n    } else if (typeof this.loader === 'function') {\n      if (this._cache && startsWith(forValue, this._cache.search) &&\n        new Date() - this._cache.ts <= CACHE_DURATION) {\n        return Promise.resolve(this._cache.items.filter(\n          item => startsWith(this.getSuggestionValue(item), forValue)\n        ))\n      }\n      return this.loader(forValue)\n        .then(res => {\n\n          if (res.items.length === res.total) {\n            // we have all results, can cache\n            this._cache = {\n              search: forValue,\n              items: res.items,\n              ts: new Date()\n            }\n          }\n\n          // if inputed value already changed do not return these suggestions\n          if (this.value !== forValue) return [];\n\n          return res.items;\n        });\n    }\n    return Promise.reject(new Error('Invalid loader'));\n  }\n\n\n  keyPressed(evt) {\n    logger.debug(`Key pressed ${evt.keyCode}`);\n    if (this._suggestionsShown) {\n      let key = evt.keyCode;\n      switch (key) {\n        case 13: // Enter\n          if (this._selected !== null) this.select(this._selected)\n          break;\n        case 40: // Down\n          this._selected++;\n          if (this._selected >= this._suggestions.length) this._selected = this._suggestions.length - 1;\n          this.makeVisible(this._selected);\n          break;\n        case 38: // Up\n          this._selected--;\n          if (this._selected < 0) this._selected = 0;\n          this.makeVisible(this._selected);\n          break;\n        case 27: // Escape\n          this.hideSuggestions();\n          break;\n      }\n    }\n    return true;\n  }\n  makeVisible(idx) {\n    let item = $(`a[data-index=\"${idx}\"]`, this.elem);\n    if (item && item.position()) {\n      this.suggestionsList.scrollTop(this.suggestionsList.scrollTop() + item.position().top);\n    }\n  }\n\n  select(idx) {\n    logger.debug(`Selected index ${idx}`);\n    let newValue = this.getSuggestionValue(this._suggestions[idx]);\n    logger.debug(`Selected ${newValue}`);\n    if (this.value !== newValue) this._ignoreChange = true;\n    this.value = newValue;\n    this.selectedValue = this._suggestions[idx];\n    this.hideSuggestions()\n  }\n\n  hideSuggestions() {\n    this._suggestionsShown = false;\n    this._selected = null;\n    this.suggestionsList.hide();\n  }\n\n  showSuggestions() {\n    this._suggestionsShown = true;\n    this._selected = this._suggestions.length ? 0 : null;\n    this.suggestionsList.show();\n    this.makeVisible(this._selected);\n  }\n\n\n}\n","import {bindable,  inject, LogManager} from 'aurelia-framework';\nimport $ from 'jquery';\n\nlet logger = LogManager.getLogger('context-menu');\n\ninject(Element)\nexport class ContextMenu {\n  @bindable items;\n  @bindable title = 'Context Menu';\n  @bindable width = 128;\n  @bindable action;\n\n  constructor(elem) {\n    this.elem = elem\n  }\n\n  attached() {\n    this.root = $('div.context-menu', this.elem);\n    $(window).click(() => this.hide());\n\n  }\n\n  show(evt, context) {\n    this.context = context;\n    evt.stopPropagation();\n    this.root.show();\n    let {pageX,pageY} = evt;\n    this.root.offset({top:pageY, left:pageX});\n\n    let {top,left} = this.root.offset()\n    let win = $(window);\n    let bottom = top+this.root.height();\n    let right = left + this.root.width();\n\n    if (right > win.width()) pageX = pageX - this.root.width();\n    if (bottom > win.height()) pageY = pageY - this.root.height();\n    this.root.offset({top:pageY, left:pageX});\n\n  }\n\n  hide() {\n    this.root.hide();\n  }\n\n  select(item) {\n    if (this.action) this.action(item.value, this.context)\n    else alert(`Selected ${item.value}`);\n    this.hide();\n  }\n\n}\n","\nexport function configure(config) {\nconfig.globalResources('./page-controller', './pager', './sorter');\n}\n","import {bindable, processContent, noView, inject, customElement, computedFrom} from 'aurelia-framework'\nimport {LogManager} from 'aurelia-framework';\nconst logger = LogManager.getLogger('page-controller');\n\n@noView()\n@processContent(false)\n@customElement('page-controller')\nexport class PageController {\n  @bindable page=1;\n  @bindable sort;\n  lastPage;\n  @bindable pageSize = 10;\n  loading=false;\n  data=[];\n  @bindable loader = () => Promise.reject(new Error('No loader specified!'));\n  @bindable noSort=false;\n\n  constructor() {\n    logger.debug('Constructing PageContoller');\n\n    if (history.state) {\n      const state=history.state;\n      logger.debug('restoring page-controller back to '+JSON.stringify(state));\n      if (state.page && state.page != this.page) {\n        this.page=state.page;\n      }\n      if (state.sort) {\n        this.sort=state.sort;\n        logger.debug(`sort2 is ${this.sort}`);\n      }\n    }\n    }\n\n  created(owningView, myView) {\n    logger.debug('Creating PageController');\n  }\n  bind(ctx) {\n    logger.debug(`Binding PageController`);\n    // if status is restored from history change to page will not happen so we need to load page here\n    if (history.state && history.state.page || this.noSort) this.loadPage(this.page);\n\n  }\n  attached() {\n    logger.debug('PageController attached');\n  }\n\n  loadPage(page, unbinded=false) {\n    //if (this.loading) return Promise.resolve(null);\n    logger.debug(`Loading page ${page}, ${this.sort} by ${this.loader.name}`);\n    this.loading=true;\n    return this.loader(page, this.pageSize, this.sort)\n      .then(({data,lastPage}) => { this.data=data;\n                                this.lastPage=lastPage },\n            err => logger.error(`Page load error: ${err}`))\n      .then(() => this.loading=false);\n  }\n\n  pageChanged(newPage) {\n    logger.debug('page changed '+newPage);\n    this.loadPage(this.page)\n    .then(() => {history.replaceState({...(history.state || {}), page:this.page, sort:this.sort}, '')});\n  }\n\n  sortChanged(newValue, old) {\n    logger.debug(`sort changed ${this.sort}`);\n    this.reset();\n\n  }\n\n  loaderChanged() {\n    logger.debug('Loader changed in PageController');\n    this.reset();\n  }\n\n  reset() {\n    const oldPage=this.page;\n    this.page=1;\n    if (oldPage==1) this.pageChanged(1,1);\n  }\n\n  @computedFrom('data', 'loader')\n  get empty() {\n    return ! this.data || this.data.length==0;\n  }\n\n}\n","import {inject,DOM, bindable} from 'aurelia-framework'\nimport {LogManager} from 'aurelia-framework';\nconst logger = LogManager.getLogger('pager');\n\n@inject(DOM.Element)\nexport class Pager{\n  @bindable page;\n  @bindable lastPage;\n  @bindable loading = false;\n\n  constructor(elem) {\n    this.elem=elem;\n  }\n\n  activated() {\n    logger.debug('Pager activated');\n  }\n\n  nextPage() {\n    if (this.page < this.lastPage && ! this.loading) this.page++;\n  }\n\n  prevPage() {\n    if (this.page >1 && ! this.loading) this.page--;\n  }\n\n  get nextPageNo() {\n    return Math.min(this.lastPage, this.page+1)\n  }\n\n  get prevPageNo() {\n    return Math.max(this.page-1, 1)\n  }\n\n  get isFirstPage() {\n    return this.page===1\n  }\n\n  get isLastPage() {\n    return this.page === this.lastPage || ! this.lastPage\n  }\n}\n","import {\n  bindable,\n  LogManager\n} from 'aurelia-framework';\nconst logger = LogManager.getLogger('sorter');\n\nexport class sorter {\n  @bindable sort;\n  @bindable sortings;\n\n  constructor() {\n    if (history.state) {\n      const state = history.state;\n      logger.debug('restoring sorter back to ' + JSON.stringify(state));\n      if (state.sort) {\n        this.sort = state.sort;\n        logger.debug(`sort is ${this.sort}`);\n      }\n    }\n  }\n\n}\n","import {bindable, bindingMode, LogManager} from 'aurelia-framework';\n\nlet logger = LogManager.getLogger('rating')\n\nexport class Rating {\n  @bindable numStars=5;\n  @bindable({defaultBindingMode: bindingMode.twoWay}) rating;\n  @bindable size = 1.0;\n  @bindable max = 100;\n  @bindable onRatingChange;\n  @bindable readOnly;\n\n\n  constructor() {\n  }\n\n  bind() {\n    this.stars=[];\n    for (let i=0; i<this.numStars; i++) this.stars.push({rated:false, proposed:false});\n    logger.debug('Bound rating '+this.rating);\n    this.updateRating(this.rating);\n  }\n\n  updateRating(v) {\n    let idx = Math.round(v/(this.max / this.numStars)) - 1\n    for (let i=0; i<=idx; i++) this.stars[i].rated=true;\n    for (let i=idx+1; i < this.numStars; i++) this.stars[i].rated=false;\n  }\n\n  ratingChanged(v) {\n    logger.debug('Rating changed '+this.rating);\n    this.updateRating(v)\n    if (this.onRatingChange) {\n      let res = this.onRatingChange(this.rating);\n      if (res instanceof Promise) {\n        res.catch(err => logger.error('Rating update failed: '+ err));\n      }\n    }\n\n  }\n\n  propose(idx) {\n    if (this.readOnly) return;\n    for (let i=0; i<=idx; i++) this.stars[i].proposed=true;\n    for (let i=idx+1; i < this.numStars; i++) this.stars[i].proposed=false;\n  }\n\n  clearProposed() {\n    if (this.readOnly) return;\n    for (let i=0; i<this.numStars; i++) this.stars[i].proposed=false;\n  }\n\n  rate(idx) {\n    if (this.readOnly) return;\n    this.rating = this.max / this.numStars * (idx+1);\n    this.clearProposed()\n\n  }\n\n  resetRating() {\n    this.rating = null;\n  }\n\n}\n","import {\n  inject,\n  LogManager\n} from 'aurelia-framework';\n\nimport config from 'config/config';\n\nlet logger = LogManager.getLogger('config');\n\nexport class Configure {\n\n  constructor() {\n    this._config = config;\n  }\n\n  get(key, defval = undefined) {\n    var parent = this._config;\n    for (var k of key.split('.')) {\n      if (parent.hasOwnProperty(k) && parent[k]) {\n        parent = parent[k];\n      } else {\n        return defval;\n      };\n    }\n    return parent;\n  }\n\n}\n","import {Configure} from './config';\nimport {LogManager} from 'aurelia-framework';\n\nlet logger=LogManager.getLogger('config');\n\nexport function configure(aurelia, cb) {\n  logger.debug('Calling configure method')\n  let instance= aurelia.container.get(Configure);\n  if (cb && typeof cb=='function') {\n    cb(instance);\n  }\n}\n\nexport {Configure}\n",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"sourceRoot":"../src"}